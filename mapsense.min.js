(function(){function Y(c){var b=c.indexOf(":");return 0>b?c:{space:m.ns[c.substring(0,b)],local:c.substring(b+1)}}function E(c){for(c=0;c<E.maps.length;c++)E.maps[c].resize()}function P(c){return 360/Math.PI*Math.atan(Math.exp(c*Math.PI/180))-90}function Q(c){return 180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360))}function U(c,b){if(c.row>b.row){var e=c;c=b;b=e}return{x0:c.column,y0:c.row,x1:b.column,y1:b.row,dx:b.column-c.column,dy:b.row-c.row}}function W(c,b,e,a,d){var g=Math.max(e,Math.floor(b.y0));
a=Math.min(a,Math.ceil(b.y1));if(c.x0==b.x0&&c.y0==b.y0?c.x0+b.dy/c.dy*c.dx<b.x1:c.x1-b.dy/c.dy*c.dx<b.x0)e=c,c=b,b=e;e=c.dx/c.dy;for(var f=b.dx/b.dy,k=0<c.dx,l=0>b.dx;g<a;g++){var p=e*Math.max(0,Math.min(c.dy,g+k-c.y0))+c.x0,h=f*Math.max(0,Math.min(b.dy,g+l-b.y0))+b.x0;d(Math.floor(h),Math.ceil(p),g)}}function X(c,b,e,a,d,g){var f=U(c,b);b=U(b,e);c=U(e,c);f.dy>b.dy&&(e=f,f=b,b=e);f.dy>c.dy&&(e=f,f=c,c=e);b.dy>c.dy&&(e=b,b=c,c=e);f.dy&&W(c,f,a,d,g);b.dy&&W(c,b,a,d,g)}var R={version:"1.0.0"},m=R,S=
{x:0,y:0};m.ns={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};m.id=function(){var c=0;return function(){return++c}}();m.svg=function(c){return document.createElementNS(m.ns.svg,c)};m.transform=function(c,b,e,a,d,g){var f={},k,l,p;arguments.length||(c=1,b=d=e=0,a=1,g=0);f.zoomFraction=function(d){if(!arguments.length)return l;l=d;k=Math.floor(l+Math.log(Math.sqrt(c*c+b*b+e*e+a*a))/Math.LN2);p=Math.pow(2,-k);return f};f.apply=function(f){var n=Math.pow(2,-f.zoom),p=Math.pow(2,
f.zoom-k);return{column:(c*f.column*n+e*f.row*n+d)*p,row:(b*f.column*n+a*f.row*n+g)*p,zoom:f.zoom-k}};f.unapply=function(f){var n=Math.pow(2,-f.zoom),p=Math.pow(2,f.zoom+k);return{column:(f.column*n*a-f.row*n*e-d*a+g*e)/(c*a-b*e)*p,row:(f.column*n*b-f.row*n*c-d*b+g*c)/(e*b-a*c)*p,zoom:f.zoom+k}};f.toString=function(){return"matrix("+[c*p,b*p,e*p,a*p].join(" ")+" 0 0)"};return f.zoomFraction(0)};m.cache=function(c,b){function e(a){h--;b&&b(a);delete f[a.key];if(a.next)a.next.prev=a.prev;else if(l=
a.prev)l.next=null;if(a.prev)a.prev.next=a.next;else if(k=a.next)k.prev=null}function a(){for(var a=l;h>p&&a;a=a.prev)a.lock||e(a)}var d={},g={},f={},k=null,l=null,p=64,h=0;d.peek=function(a){return f[[a.zoom,a.column,a.row].join("/")]};d.load=function(a,d){var e=[a.zoom,a.column,a.row].join("/"),b=f[e];if(b)return b.prev&&((b.prev.next=b.next)?b.next.prev=b.prev:l=b.prev,b.prev=null,b.next=k,k=k.prev=b),b.lock=1,g[e]=b;b={key:e,column:a.column,row:a.row,zoom:a.zoom,next:k,prev:null,lock:1};c.call(null,
b,d);g[e]=f[e]=b;k?k.prev=b:l=b;k=b;h++;return b};d.unload=function(a){if(!(a in g))return!1;var f=g[a];f.lock=0;delete g[a];f.request&&f.request.abort(!1)&&e(f);return f};d.locks=function(){return g};d.size=function(f){if(!arguments.length)return p;p=f;a();return d};d.flush=function(){a();return d};d.clear=function(){for(var a in f){var c=f[a];c.request&&c.request.abort(!1);b&&b(f[a]);c.lock&&(c.lock=0,c.element.parentNode.removeChild(c.element))}g={};f={};k=l=null;h=0;return d};return d};m.url=
function(c){function b(d){var b=0>d.zoom?1:1<<d.zoom,f=d.column;if(a)f=d.column%b,0>f&&(f+=b);else if(0>f||f>=b)return null;return("function"===typeof c?c(d):c).replace(/{(.)}/g,function(a,b){switch(b){case "S":return e[(Math.abs(d.zoom)+d.row+f)%e.length];case "Z":return d.zoom;case "X":return f;case "Y":return d.row;case "B":var c=m.map.coordinateLocation({row:d.row,column:f,zoom:d.zoom}),g=m.map.coordinateLocation({row:d.row+1,column:f+1,zoom:d.zoom}),n=Math.ceil(Math.log(d.zoom)/Math.LN2);return g.lat.toFixed(n)+
","+c.lon.toFixed(n)+","+c.lat.toFixed(n)+","+g.lon.toFixed(n)}return b})}var e=[],a=!0;b.template=function(a){if(!arguments.length)return c;c=a;return b};b.hosts=function(a){if(!arguments.length)return e;e=a;return b};b.repeat=function(c){if(!arguments.length)return a;a=c;return b};return b};m.dispatch=function(c){var b={};c.on=function(e,a){for(var d=b[e]||(b[e]=[]),g=0;g<d.length;g++)if(d[g].handler==a)return c;d.push({handler:a,on:!0});return c};c.off=function(e,a){var d=b[e];if(d)for(var g=0;g<
d.length;g++){var f=d[g];if(f.handler==a){f.on=!1;d.splice(g,1);break}}return c};return function(e){var a=b[e.type];if(a)for(var a=a.slice(),d=0;d<a.length;d++){var g=a[d];g.on&&g.handler.call(c,e)}}};m.queue=function(){function c(){6<=g||!d.length||(g++,d.pop()())}function b(a){for(var b=0;b<d.length;b++)if(d[b]==a)return d.splice(b,1),!0;return!1}function e(a,b){for(var c in b)a[c]=b[c];return a}function a(a,e,l){function p(){h=new XMLHttpRequest;h.open("GET",a,!0);if(l&&(l.mimeType&&h.overrideMimeType&&
h.overrideMimeType(l.mimeType),l.responseType&&(h.responseType=l.responseType),l.xhrFields))for(var b in l.xhrFields)h[b]=l.xhrFields[b];h.onreadystatechange=function(a){4==h.readyState&&(g--,300>h.status&&e(h),c())};h.send(null)}var h;d.push(p);c();return{abort:function(a){return b(p)?!0:a&&h?(h.abort(),!0):!1}}}var d=[],g=0;return{text:function(b,c,d){return a(b,function(a){a.responseText&&c(a.responseText)},{mimeType:d})},xml:function(b,c,d){return a(b,function(a){a.responseXML&&c(a.responseXML)},
e({mimeType:"application/xml"},d))},json:function(b,c,d){return a(b,function(a){a.responseText&&c(JSON.parse(a.responseText))},e({mimeType:"application/json"},d))},octetStream:function(b,c,d){return a(b,function(a){a.response&&c(a.response)},e({mimeType:"application/octet-stream",responseType:"arraybuffer"},d))},image:function(a,e,l){function p(){h=document.createElement("img");h.onerror=function(){g--;c()};h.onload=function(){g--;l(h);c()};h.src=e;a.setAttributeNS(m.ns.xlink,"href",e)}var h;d.push(p);
c();return{abort:function(a){return b(p)?!0:a&&h?(h.src="about:",!0):!1}}}}}();m.map=function(c){function b(){t&&(h<t[0]?h=t[0]:h>t[1]&&(h=t[1]));n=h-(h=Math.round(h));r=Math.pow(2,n)}function e(){if(G){var a=45/Math.pow(2,h+n-3),b=Math.max(Math.abs(w*k.x+u*k.y),Math.abs(H*k.x+A*k.y)),c=P(B-b*a/l.y),b=P(T+b*a/l.y);p.lat=Math.max(c,Math.min(b,p.lat));c=Math.max(Math.abs(w*k.y+u*k.x),Math.abs(H*k.y+A*k.x));p.lon=Math.max(G[0].lon-c*a/l.x,Math.min(G[1].lon+c*a/l.x,p.lon))}}var a={},d,g,f=S,k=S,l={x:512,
y:512},p={lat:37.76487,lon:-122.41948},h=12,n=0,r=1,t=[1,18],C=0,u=1,w=0,A=1,H=0,B=-180,T=180,G=[{lat:P(B),lon:-Infinity},{lat:P(T),lon:Infinity}],O=m.interact();d="string"===typeof c?document.querySelector(c):c;if(!d)throw Error("Invalid map container.");a.interact=function(b){if(!arguments.length)return O;O.map(b?a:null)};a.locationCoordinate=function(a){a=m.map.locationCoordinate(a);var b=Math.pow(2,h);a.column*=b;a.row*=b;a.zoom+=h;return a};a.coordinateLocation=m.map.coordinateLocation;a.coordinatePoint=
function(a,b){var c=Math.pow(2,h-b.zoom),d=Math.pow(2,h-a.zoom),f=(b.column*c-a.column*d)*l.x*r,c=(b.row*c-a.row*d)*l.y*r;return{x:k.x+u*f-w*c,y:k.y+w*f+u*c}};a.pointCoordinate=function(a,b){var c=Math.pow(2,h-a.zoom),d=(b.x-k.x)/r,f=(b.y-k.y)/r;return{column:a.column*c+(A*d-H*f)/l.x,row:a.row*c+(H*d+A*f)/l.y,zoom:h}};a.locationPoint=function(a){var b=Math.pow(2,h+n-3)/45,c=(a.lon-p.lon)*b*l.x;a=(Q(p.lat)-Q(a.lat))*b*l.y;return{x:k.x+u*c-w*a,y:k.y+w*c+u*a}};a.pointLocation=function(a){var b=45/Math.pow(2,
h+n-3),c=(a.x-k.x)*b;a=(a.y-k.y)*b;return{lon:p.lon+(A*c-H*a)/l.x,lat:P(Q(p.lat)-(H*c+A*a)/l.y)}};var x=m.svg("rect");x.setAttribute("visibility","hidden");x.setAttribute("pointer-events","all");var I=m.svg("svg");I.setAttribute("class","mapsense-map");I.appendChild(x);var F=document.createElement("div");F.style.setProperty("position","relative");F.style.setProperty("width","100%");F.style.setProperty("height","100%");F.appendChild(I);d.appendChild(F);a.container=function(){return d};a.relativeContainer=
function(){return F};a.svgContainer=function(){return I};a.focusableParent=function(){for(var a=d;a;a=a.parentNode)if(0<=a.tabIndex)return a;return window};a.mouse=function(a){var b=(I.ownerSVGElement||I).createSVGPoint();if(0>V&&(window.scrollX||window.scrollY)){var c=document.body.appendChild(m.svg("svg"));c.style.position="absolute";c.style.top=c.style.left="0px";var d=c.getScreenCTM();V=!(d.f||d.e);document.body.removeChild(c)}V?(b.x=a.pageX,b.y=a.pageY):(b.x=a.clientX,b.y=a.clientY);return b.matrixTransform(I.getScreenCTM().inverse())};
a.size=function(b){if(!arguments.length)return f;g=b;return a.resize()};a.resize=function(){if(g)f=g,E.remove(a);else{x.setAttribute("width","100%");x.setAttribute("height","100%");var b=x.getBBox();f={x:b.width,y:b.height};E.add(a)}x.setAttribute("width",f.x);x.setAttribute("height",f.y);k={x:f.x/2,y:f.y/2};e();a.dispatch({type:"resize"});return a};a.tileSize=function(b){if(!arguments.length)return l;l=b;a.dispatch({type:"move"});return a};a.center=function(b){if(!arguments.length)return p;p=b;e();
a.dispatch({type:"move"});return a};a.panBy=function(b){var c=45/Math.pow(2,h+n-3),d=b.x*c;b=b.y*c;return a.center({lon:p.lon+(H*b-A*d)/l.x,lat:P(Q(p.lat)+(H*d+A*b)/l.y)})};a.centerRange=function(b){if(!arguments.length)return G;(G=b)?(B=-90<G[0].lat?Q(G[0].lat):-Infinity,T=90>G[0].lat?Q(G[1].lat):Infinity):(B=-Infinity,T=Infinity);e();a.dispatch({type:"move"});return a};a.zoom=function(c){if(!arguments.length)return h+n;h=c;b();return a.center(p)};a.zoomBy=function(c,d,f){if(2>arguments.length)return a.zoom(h+
n+c);3>arguments.length&&(f=a.pointLocation(d));h=h+n+c;b();var e=a.locationPoint(f);return a.panBy({x:d.x-e.x,y:d.y-e.y})};a.zoomRange=function(b){if(!arguments.length)return t;t=b;return a.zoom(h+n)};a.extent=function(c){if(!arguments.length)return[a.pointLocation({x:0,y:f.y}),a.pointLocation({x:f.x,y:0})];var d=a.locationPoint(c[0]),e=a.locationPoint(c[1]),g=Math.max((e.x-d.x)/f.x,(d.y-e.y)/f.y),d=a.pointLocation({x:(d.x+e.x)/2,y:(d.y+e.y)/2});h=h+n-Math.log(g)/Math.LN2;b();return a.center(d)};
a.angle=function(b){if(!arguments.length)return C;C=b;u=Math.cos(C);w=Math.sin(C);A=Math.cos(-C);H=Math.sin(-C);e();a.dispatch({type:"move"});return a};a.add=function(b){b.map(a);return a};a.remove=function(b){b.map(null);return a};a.dispatch=m.dispatch(a);a.interact(!0);return a.resize()};E.maps=[];E.add=function(c){for(var b=0;b<E.maps.length;b++)if(E.maps[b]==c)return;E.maps.push(c)};E.remove=function(c){for(var b=0;b<E.maps.length;b++)if(E.maps[b]==c){E.maps.splice(b,1);break}};window.addEventListener&&
(window.addEventListener("resize",E,!1),window.addEventListener("load",E,!1));m.map.locationCoordinate=function(c){var b=1/360;return{column:(c.lon+180)*b,row:(180-Q(c.lat))*b,zoom:0}};m.map.coordinateLocation=function(c){var b=45/Math.pow(2,c.zoom-3);return{lon:b*c.column-180,lat:P(180-b*c.row)}};var V=/WebKit/.test(navigator.userAgent)?-1:0;m.layer=function(c,b){function e(a){for(var b=u[0].nextSibling;C<a;C++){r.insertBefore(u[-4],b);r.insertBefore(u[2],b);r.insertBefore(u[1],b);for(var c=u[-4],
d=-4;2>d;)u[d]=u[++d];u[d]=c}}function a(a){for(var b=u[0].nextSibling;C>a;C--){r.insertBefore(u[-1],b);r.insertBefore(u[2],u[-4]);for(var c=u[2],d=2;-4<d;)u[d]=u[--d];u[d]=c}}function d(){function b(a){var c=a.zoom,d=0>c?1:1<<c,f=a.column%d,e=a.row;0>f&&(f+=d);return{locationPoint:function(a){a=m.map.locationCoordinate(a);var b=Math.pow(2,c-a.zoom);return{x:F.x*(b*a.column-f),y:F.y*(b*a.row-e)}}}}function c(a,d,e){for(var g=v.zoom,h=2-M,k=4+M;a<d;a++){var n=f.load({column:a,row:e,zoom:g},b);if(!(n.ready||
n.key in K)){n.proxyRefs={};for(var q,p,l,m=1;m<=h;m++){p=!0;for(var N=0,r=1<<m;N<=r;N++)for(var y=0;y<=r;y++)(l=f.peek(q={column:(a<<m)+y,row:(e<<m)+N,zoom:g+m}))&&l.ready?(K[l.key]=f.load(q),l.proxyCount++,n.proxyRefs[l.key]=l):p=!1;if(p)break}if(!p)for(m=1;m<=k;m++)if((l=f.peek(q={column:a>>m,row:e>>m,zoom:g-m}))&&l.ready){K[l.key]=f.load(q);l.proxyCount++;n.proxyRefs[l.key]=l;break}}K[n.key]=n}}function d(a){return Math.round(256*a)/256}var h=g.map(),n=h.zoom(),t=n-(n=Math.round(n)),x=h.size(),
w=h.angle(),F=h.tileSize(),D=h.locationCoordinate(h.center());if(C!=n){C<n?e(n):C>n?a(n):C=n;for(var q=-4;2>=q;q++){var J=u[q];J.setAttribute("class","zoom"+(0>q?"":"+")+q+" zoom"+(n+q));J.setAttribute("transform","scale("+Math.pow(2,-q)+")")}}var v=h.pointCoordinate(D,S),q=h.pointCoordinate(D,{x:x.x,y:0}),n=h.pointCoordinate(D,x),h=h.pointCoordinate(D,{x:0,y:x.y}),J=D.column,L=D.row;D.column=Math.round((Math.round(F.x*D.column)+(x.x&1)/2)/F.x);D.row=Math.round((Math.round(F.y*D.row)+(x.y&1)/2)/F.y);
var J=J-D.column,L=L-D.row,z=d(Math.pow(2,t));r.setAttribute("transform","translate("+Math.round(x.x/2-J*F.x*z)+","+Math.round(x.y/2-L*F.y*z)+")"+(w?"rotate("+w/Math.PI*180+")":"")+(t?"scale("+z+")":"")+(y?y.zoomFraction(t):""));y&&(v=y.unapply(v),q=y.unapply(q),n=y.unapply(n),h=y.unapply(h),D=y.unapply(D));var M=p?p(v.zoom)-v.zoom:0;M&&(y=Math.pow(2,M),v.column*=y,v.row*=y,q.column*=y,q.row*=y,n.column*=y,n.row*=y,h.column*=y,h.row*=y,v.zoom=q.zoom=n.zoom=h.zoom+=M);var t=f.locks(),K={},N;for(N in t)t[N].proxyCount=
0;l&&-5<M&&3>M&&(x=0>v.zoom?1:1<<v.zoom,k?(X(v,q,n,0,x,c),X(n,h,v,0,x,c)):(y=Math.floor((v.column+n.column)/2),x=Math.max(0,Math.min(x-1,Math.floor((q.row+h.row)/2))),q=Math.min(4,v.zoom),y=y>>q<<q,c(y,y+1,x>>q<<q)));for(N in K){var q=K[N],y=d(Math.pow(2,q.level=q.zoom-D.zoom)),y="translate("+Math.round(q.x=F.x*(q.column-D.column*y))+"px,"+Math.round(q.y=F.y*(q.row-D.row*y))+"px)";d3.select(q.element).style("transform",y);d3.select(q.element).style("-webkit-transform",y);d3.select(q.element).style("-ms-transform",
y)}for(N in t)N in K||(q=f.unload(N),q.element.parentNode.removeChild(q.element),delete q.proxyRefs);for(N in K)q=K[N],q.element.parentNode!=u[q.level]&&(u[q.level].appendChild(q.element),g.show&&g.show(q));f.flush();g.dispatch({type:"move"})}var g={},f=g.cache=m.cache(c,b).size(512),k=!0,l=!0,p,h,n,r=m.svg("g"),t,C,u={};r.setAttribute("class","layer");for(var w=-4;-1>=w;w++)u[w]=r.appendChild(m.svg("g"));for(w=2;1<=w;w--)u[w]=r.appendChild(m.svg("g"));u[0]=r.appendChild(m.svg("g"));g.map=function(a){if(!arguments.length)return n;
if(n){if(n==a)return r.parentNode.appendChild(r),g;n.off("move",d).off("resize",d);r.parentNode.removeChild(r)}if(n=a)n.svgContainer().appendChild(r),g.init&&g.init(r),n.on("move",d).on("resize",d),d();return g};g.container=function(){return r};g.levels=function(){return u};g.id=function(a){if(!arguments.length)return h;h=a;r.setAttribute("id",a);return g};g.visible=function(a){if(!arguments.length)return l;(l=a)?r.removeAttribute("visibility"):r.setAttribute("visibility","hidden");n&&d();return g};
g.transform=function(a){if(!arguments.length)return t;t=a;n&&d();return g};g.zoom=function(a){if(!arguments.length)return p;p="function"==typeof a||null==a?a:function(){return a};n&&d();return g};g.tile=function(a){if(!arguments.length)return k;k=a;n&&d();return g};g.reload=function(){f.clear();n&&d();return g};g.dispatch=m.dispatch(g);g.on("load",function(a){if(a.tile.proxyRefs){for(var b in a.tile.proxyRefs){var c=a.tile.proxyRefs[b];0>=--c.proxyCount&&f.unload(b)&&c.element.parentNode.removeChild(c.element)}delete a.tile.proxyRefs}});
return g};m.image=function(){var c=m.layer(function(e){var a=e.element=m.svg("image"),d=c.map().tileSize();a.setAttribute("preserveAspectRatio","none");a.setAttribute("width",d.x);a.setAttribute("height",d.y);"function"==typeof b?(a.setAttribute("opacity",0),d=b(e),null!=d?e.request=m.queue.image(a,d,function(b){delete e.request;e.ready=!0;e.img=b;a.removeAttribute("opacity");c.dispatch({type:"load",tile:e})}):(e.ready=!0,c.dispatch({type:"load",tile:e}))):(e.ready=!0,null!=b&&a.setAttributeNS(m.ns.xlink,
"href",b),c.dispatch({type:"load",tile:e}))},function(b){b.request&&b.request.abort(!0)}),b;c.url=function(e){if(!arguments.length)return b;b="string"==typeof e&&/{.}/.test(e)?m.url(e):e;return c.reload()};return c};m.geoJson=function(c){function b(a){var b={lat:0,lon:0};return function(c,d){b.lat=c[1];b.lon=c[0];var f=a(b);d.x=f.x;d.y=f.y;return f}}function e(a){return d3.geo.path().projection({stream:function(b){return{point:function(c,d){d=Math.min(89.999999,d);d=Math.max(-89.999999,d);var f=a.locationPoint({lon:c,
lat:d});b.point(Math.round(2*f.x)/2,Math.round(2*f.y)/2)},sphere:function(){b.sphere()},lineStart:function(){b.lineStart()},lineEnd:function(){b.lineEnd()},polygonStart:function(){b.polygonStart()},polygonEnd:function(){b.polygonEnd()}}}})}function a(a,b){b(a.geometry.coordinates,a);return a}function d(a,b){for(var c=a.geometry.coordinates.length,d=[],f=0;f<c;f++){var e;e=a;var g={},h=void 0;for(h in e)g[h]=e[h];e=g;b(e.geometry.coordinates[f],e);d.push(e)}return d}function g(c,f){var g=b(f.proj.locationPoint),
h=e(f.proj),n=[],p=[],l=[];(B?B(f.fetched,f):f.fetched).forEach(function(b){"Point"===b.geometry.type?p.push(a(b,g)):"MultiPoint"===b.geometry.type?p.push.apply(p,d(b,g)):n.push(b)});var m=d3.select(c).selectAll("path").data(n,E);m.enter().append("path").attr("d",function(a){return h(a)});m.exit().remove();m.each(function(a){l.push({element:this,data:a})});var r="";"fixed"==u&&(r="scale("+Math.pow(2,f.zoom-(f.scale=k.map().zoom()))+")");var t=d3.select(c).selectAll("circle").data(p,E);t.enter().append("circle").attr("transform",
function(a){return"translate("+a.x+","+a.y+")"+r}).attr("r",w);t.exit().remove();t.each(function(a){l.push({element:this,data:a})});G&&(m.push.apply(m,t),G(m));f.features=l;f.dataGeneration=O;f.selectionGeneration=x}function f(){var a=k.map().zoom(),b=k.cache.locks(),c,d,f,e,g,h,n;if("fixed"==u)for(c in b)if((d=b[c]).scale!=a){n="scale("+Math.pow(2,d.zoom-a)+")";e=-1;for(g=(f=d.features).length;++e<g;){var p=(h=f[e]).data,l=p.geometry;l.type in I&&I[l.type](p,h.element,n)}d.scale=a}}var k=m.layer(function(a,
b){function d(b){if(k.tile()&&H){var c=k.map().tileSize();d3.select(f.insertBefore(m.svg("rect"),f.firstChild)).attr("width",c.x).attr("height",c.x).attr("class","tile-background")}a.fetched=b.features;a.draw();a.ready=!0;k.dispatch({type:"load",tile:a,features:a.features})}var f=a.element=m.svg("g");a.proj=b(a);a.fetched=[];a.features=[];a.draw=function(){g(f,a)};null!=p?a.request=c("function"==typeof p?p(a):p,d):d({type:"FeatureCollection",features:A||[]})},function(a){a.request&&a.request.abort(!0)}),
l=k.container(),p,h=!1,n="org.polymaps."+m.id(),r="url(#"+n+")",t=l.insertBefore(m.svg("clipPath"),l.firstChild),C=t.appendChild(m.svg("rect")),u="fixed",w=4.5,A,H=!1,B,E=function(){var a=0;return function(b){return a=a+1|0}}(),G,O=0,x=0;l.setAttribute("fill-rule","evenodd");t.setAttribute("id",n);arguments.length||(c=m.queue.json);var I={Point:function(a,b,c){b.setAttribute("transform","translate("+a.x+","+a.y+")"+c)},MultiPoint:function(a,b,c){b.setAttribute("transform","translate("+a.x+","+a.y+
")"+c)}};k.tileBackground=function(a){if(!arguments.length)return H;H=a;return k};k.selection=function(a){if(!arguments.length)return G;G=a;x=x+1|0;return k.reshow()};k.transformData=function(a){if(!arguments.length)return B;B=a;O=O+1|0;return k.reshow()};k.url=function(a){if(!arguments.length)return p;p="string"==typeof a&&/{.}/.test(a)?m.url(a):a;null!=p&&(A=null);"string"==typeof p&&k.tile(!1);return k.reload()};k.features=function(a){if(!arguments.length)return A;if(A=a)p=null,k.tile(!1);return k.reload()};
k.clip=function(a){if(!arguments.length)return h;h&&l.removeChild(t);(h=a)&&l.insertBefore(t,l.firstChild);var b=k.cache.locks(),c;for(c in b)h?b[c].element.setAttribute("clip-path",r):b[c].element.removeAttribute("clip-path");return k};var F=k.tile;k.tile=function(a){arguments.length&&!a&&k.clip(a);return F.apply(k,arguments)};var D=k.map;k.map=function(a){if(a&&C){var b=a.tileSize();C.setAttribute("width",b.x);C.setAttribute("height",b.y)}return D.apply(k,arguments)};k.scale=function(a){if(!arguments.length)return u;
if(u=a)k.on("move",f);else k.off("move",f);k.map()&&f();return k};k.show=function(a){h?a.element.setAttribute("clip-path",r):a.element.removeAttribute("clip-path");if(B&&a.dataGeneration!==O)a.draw();else if(G&&a.selectionGeneration!==x){var b=d3.select(a.element).selectAll("path,circle");G(b);a.selectionGeneration=x}k.dispatch({type:"show",tile:a,features:a.features});return k};k.reshow=function(){var a=k.cache.locks(),b;for(b in a)k.show(a[b]);return k};return k};m.topoJson=function(c){function b(a){if(!e)return a;
var b={},c=[];a.forEach(function(a){var d=e(a),f=b[d];void 0===f&&(f=c.push([])-1,b[d]=f);c[f].push(a)});return c.map(function(a){return{type:"GeometryCollection",geometries:a}})}arguments.length||(c=m.queue.json);var e,a,d=function(a){function c(a,b,d,f){a=topojson.feature(a,b);a="FeatureCollection"===a.type?a.features:[a];a.forEach(function(a){a.properties.layer=d});f.push.apply(f,a)}var d=[],e;for(e in a.objects)c(a,a.objects[e],e,d);return d=b(d)},g=m.geoJson(function(a,b){return c(a,function(a){b({type:"FeatureCollection",
features:d(a)})})});g.topologyFeatures=function(a){if(!arguments.length)return d;d=a;return g};g.classify=function(a){if(!arguments.length)return e;e=a;return g};g.staticTopology=function(b){if(!arguments.length)return a;a=b;return g.features(a?d(a):null)};return g};m.dblclick=function(){function c(b){var c=a.zoom(),c=b.shiftKey?Math.ceil(c)-c-1:1-c+Math.floor(c);"mouse"===e?a.zoomBy(c,a.mouse(b)):a.zoomBy(c)}var b={},e="mouse",a,d;b.zoom=function(a){if(!arguments.length)return e;e=a;return b};b.map=
function(e){if(!arguments.length)return a;a&&(d.removeEventListener("dblclick",c,!1),d=null);if(a=e)d=a.container(),d.addEventListener("dblclick",c,!1);return b};return b};m.drag=function(){function c(b){b.shiftKey||(g={x:b.clientX,y:b.clientY},a.focusableParent().focus(),b.preventDefault(),document.body.style.setProperty("cursor","move",null))}function b(b){g&&(a.panBy({x:b.clientX-g.x,y:b.clientY-g.y}),g.x=b.clientX,g.y=b.clientY)}var e={},a,d,g;e.map=function(b){if(!arguments.length)return a;a&&
(d.removeEventListener("mousedown",c,!1),d=null);if(a=b)d=a.container(),d.addEventListener("mousedown",c,!1);return e};window.addEventListener("mousemove",b,!1);window.addEventListener("mouseup",function(a){g&&(b(a),g=null,document.body.style.removeProperty("cursor"))},!1);return e};m.wheel=function(){function c(a){f=null}function b(b){var e=b.wheelDelta||-b.detail,p;if(e)if(d){try{h.scrollTop=1E3,h.dispatchEvent(b),e=1E3-h.scrollTop}catch(l){}e*=.001}else p=Date.now(),200<p-a?(e=0<e?1:-1,a=p):e=
0;if(e)switch(g){case "mouse":p=k.mouse(b);f||(f=k.pointLocation(p));k.off("move",c).zoomBy(e,p,f).on("move",c);break;case "location":k.zoomBy(e,k.locationPoint(f),f);break;default:k.zoomBy(e)}b.preventDefault();return!1}var e={},a=0,d=!0,g="mouse",f,k,l,p=document.createElement("div"),h=document.createElement("div");h.style.visibility="hidden";h.style.top="0px";h.style.height="0px";h.style.width="0px";h.style.overflowY="scroll";p.style.height="2000px";h.appendChild(p);document.body.appendChild(h);
e.smooth=function(a){if(!arguments.length)return d;d=a;return e};e.zoom=function(a,b){if(!arguments.length)return g;g=a;f=b;if(k)if("mouse"==g)k.on("move",c);else k.off("move",c);return e};e.map=function(a){if(!arguments.length)return k;k&&(l.removeEventListener("mousemove",c,!1),l.removeEventListener("mousewheel",b,!1),l.removeEventListener("MozMousePixelScroll",b,!1),l=null,k.off("move",c));if(k=a){if("mouse"==g)k.on("move",c);l=k.container();l.addEventListener("mousemove",c,!1);l.addEventListener("mousewheel",
b,!1);l.addEventListener("MozMousePixelScroll",b,!1)}return e};return e};m.arrow=function(){function c(b){if(!(b.ctrlKey||b.altKey||b.metaKey)){var c=Date.now(),d=0,e=0;switch(b.keyCode){case 37:g.left||(f=c,g.left=1,g.right||(d=l));break;case 39:g.right||(f=c,g.right=1,g.left||(d=-l));break;case 38:g.up||(f=c,g.up=1,g.down||(e=l));break;case 40:g.down||(f=c,g.down=1,g.up||(e=-l));break;default:return}(d||e)&&p.panBy({x:d,y:e});!k&&g.left|g.right|g.up|g.down&&(k=setInterval(a,50));b.preventDefault()}}
function b(a){f=Date.now();switch(a.keyCode){case 37:g.left=0;break;case 39:g.right=0;break;case 38:g.up=0;break;case 40:g.down=0;break;default:return}!k||g.left|g.right|g.up|g.down||(k=clearInterval(k));a.preventDefault()}function e(a){switch(a.charCode){case 45:case 95:p.zoom(Math.ceil(p.zoom())-1);break;case 43:case 61:p.zoom(Math.floor(p.zoom())+1);break;default:return}a.preventDefault()}function a(){if(p&&!(Date.now()<f+250)){var a=(g.left-g.right)*l,b=(g.up-g.down)*l;(a||b)&&p.panBy({x:a,y:b})}}
var d={},g={left:0,right:0,up:0,down:0},f=0,k,l=16,p,h;d.map=function(a){if(!arguments.length)return p;p&&(h.removeEventListener("keypress",e,!1),h.removeEventListener("keydown",c,!1),h.removeEventListener("keyup",b,!1),h=null);if(p=a)h=p.focusableParent(),h.addEventListener("keypress",e,!1),h.addEventListener("keydown",c,!1),h.addEventListener("keyup",b,!1);return d};d.speed=function(a){if(!arguments.length)return l;l=a;return d};return d};m.hash=function(){function c(){var b=f(d);a!==b&&location.replace(a=
b)}function b(){location.hash!==a&&g(d,(a=location.hash).substring(1))&&c()}var e={},a,d,g=function(a,b){var c=b.split("/").map(Number);if(3>c.length||c.some(isNaN))return!0;var d=a.size();a.zoomBy(c[0]-a.zoom(),{x:d.x/2,y:d.y/2},{lat:Math.min(89.99999999,Math.max(-89.99999999,c[1])),lon:c[2]})},f=function(a){var b=a.center();a=a.zoom();var c=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return"#"+a.toFixed(2)+"/"+b.lat.toFixed(c)+"/"+b.lon.toFixed(c)};e.map=function(a){if(!arguments.length)return d;
d&&(d.off("move",c),window.removeEventListener("hashchange",b,!1));if(d=a)d.on("move",c),window.addEventListener("hashchange",b,!1),location.hash?b():c();return e};e.parser=function(a){if(!arguments.length)return g;g=a;return e};e.formatter=function(a){if(!arguments.length)return f;f=a;return e};return e};m.touch=function(){function c(a){var b=-1,c=a.touches.length,d=Date.now();if(1==c&&300>d-g){var m=e.zoom();e.zoomBy(1-m+Math.floor(m),e.mouse(a.touches[0]));a.preventDefault()}g=d;f=e.zoom();for(k=
e.angle();++b<c;)d=a.touches[b],l[d.identifier]=e.pointLocation(e.mouse(d))}var b={},e,a,d=!1,g=0,f,k,l={};window.addEventListener("touchmove",function(a){switch(a.touches.length){case 1:var b=a.touches[0];e.zoomBy(0,e.mouse(b),l[b.identifier]);a.preventDefault();break;case 2:var b=a.touches[0],c=a.touches[1],g=e.mouse(b),t=e.mouse(c),g={x:(g.x+t.x)/2,y:(g.y+t.y)/2},b=m.map.locationCoordinate(l[b.identifier]),c=m.map.locationCoordinate(l[c.identifier]),c=m.map.coordinateLocation({row:(b.row+c.row)/
2,column:(b.column+c.column)/2,zoom:0});e.zoomBy(Math.log(a.scale)/Math.LN2+f-e.zoom(),g,c);d&&e.angle(a.rotation/180*Math.PI+k);a.preventDefault()}},!1);b.rotate=function(a){if(!arguments.length)return d;d=a;return b};b.map=function(d){if(!arguments.length)return e;e&&(a.removeEventListener("touchstart",c,!1),a=null);if(e=d)a=e.container(),a.addEventListener("touchstart",c,!1);return b};return b};m.interact=function(){var c={},b=m.drag(),e=m.wheel(),a=m.dblclick(),d=m.touch(),g=m.arrow();c.map=function(f){b.map(f);
e.map(f);a.map(f);d.map(f);g.map(f);return c};return c};m.compass=function(){function c(a){A.setAttribute("class","compass active");D||(D=setInterval(b,50));q&&z.panBy(q);G=Date.now();return h(a)}function b(){q&&Date.now()>G+250&&z.panBy(q)}function e(a){if(a.shiftKey)return v={x0:z.mouse(a)},z.focusableParent().focus(),h(a)}function a(a){v&&(v.x1=z.mouse(a),L.setAttribute("x",Math.min(v.x0.x,v.x1.x)),L.setAttribute("y",Math.min(v.x0.y,v.x1.y)),L.setAttribute("width",Math.abs(v.x0.x-v.x1.x)),L.setAttribute("height",
Math.abs(v.x0.y-v.x1.y)),L.removeAttribute("display"))}function d(a){A.setAttribute("class","compass");v&&(v.x1&&(z.extent([z.pointLocation({x:Math.min(v.x0.x,v.x1.x),y:Math.max(v.x0.y,v.x1.y)}),z.pointLocation({x:Math.max(v.x0.x,v.x1.x),y:Math.min(v.x0.y,v.x1.y)})]),L.setAttribute("display","none")),v=null);D&&(clearInterval(D),D=0)}function g(a){return function(){a?this.setAttribute("class","active"):this.removeAttribute("class");q=a}}function f(a){return function(b){A.setAttribute("class","compass active");
var c=z.zoom();z.zoom(0>a?Math.ceil(c)-1:Math.floor(c)+1);return h(b)}}function k(a){return function(b){z.zoom(a);return h(b)}}function l(){this.setAttribute("class","active")}function p(){this.removeAttribute("class")}function h(a){a.stopPropagation();a.preventDefault();return!1}function n(a){var b=Math.SQRT1_2*B,d=.7*B,e=.2*B,f=m.svg("g"),k=f.appendChild(m.svg("path")),l=f.appendChild(m.svg("path"));k.setAttribute("class","direction");k.setAttribute("pointer-events","all");k.setAttribute("d","M0,0L"+
b+","+b+"A"+B+","+B+" 0 0,1 "+-b+","+b+"Z");l.setAttribute("class","chevron");l.setAttribute("d","M"+e+","+(d-e)+"L0,"+d+" "+-e+","+(d-e));l.setAttribute("pointer-events","none");f.addEventListener("mousedown",c,!1);f.addEventListener("mouseover",g(a),!1);f.addEventListener("mouseout",g(null),!1);f.addEventListener("dblclick",h,!1);return f}function r(a){var b=.4*B,c=b/2,d=m.svg("g"),e=d.appendChild(m.svg("path")),g=d.appendChild(m.svg("path")),k=d.appendChild(m.svg("path")),n=d.appendChild(m.svg("path"));
e.setAttribute("class","back");e.setAttribute("d","M"+-b+",0V"+-b+"A"+b+","+b+" 0 1,1 "+b+","+-b+"V0Z");g.setAttribute("class","direction");g.setAttribute("d",e.getAttribute("d"));k.setAttribute("class","chevron");k.setAttribute("d","M"+-c+","+-b+"H"+c+(0<a?"M0,"+(-b-c)+"V"+-c:""));n.setAttribute("class","fore");n.setAttribute("fill","none");n.setAttribute("d",e.getAttribute("d"));d.addEventListener("mousedown",f(a),!1);d.addEventListener("mouseover",l,!1);d.addEventListener("mouseout",p,!1);d.addEventListener("dblclick",
h,!1);return d}function t(a){var b=.2*B,c=.4*B,d=m.svg("g"),e=d.appendChild(m.svg("rect")),f=d.appendChild(m.svg("path"));e.setAttribute("pointer-events","all");e.setAttribute("fill","none");e.setAttribute("x",-c);e.setAttribute("y",-.75*c);e.setAttribute("width",2*c);e.setAttribute("height",1.5*c);f.setAttribute("class","chevron");f.setAttribute("d","M"+-b+",0H"+b);d.addEventListener("mousedown",k(a),!1);d.addEventListener("dblclick",h,!1);return d}function C(){var a=B+6,b=a,c=z.size();switch(O){case "top-right":a=
c.x-a;break;case "bottom-left":b=c.y-b;break;case "bottom-right":a=c.x-a,b=c.y-b}A.setAttribute("transform","translate("+a+","+b+")");L.setAttribute("transform","translate("+-a+","+-b+")");for(var d in H)d==z.zoom()?H[d].setAttribute("class","active"):H[d].removeAttribute("class")}function u(){for(;A.lastChild;)A.removeChild(A.lastChild);A.appendChild(L);if("none"!=F){J=A.appendChild(m.svg("g"));J.setAttribute("class","pan");var a=J.appendChild(m.svg("circle"));a.setAttribute("class","back");a.setAttribute("r",
B);J.appendChild(n({x:0,y:-E})).setAttribute("transform","rotate(0)");J.appendChild(n({x:E,y:0})).setAttribute("transform","rotate(90)");J.appendChild(n({x:0,y:E})).setAttribute("transform","rotate(180)");J.appendChild(n({x:-E,y:0})).setAttribute("transform","rotate(270)");a=J.appendChild(m.svg("circle"));a.setAttribute("fill","none");a.setAttribute("class","fore");a.setAttribute("r",B)}else J=null;if("none"!=x){I=A.appendChild(m.svg("g"));I.setAttribute("class","zoom");a=-.5;if("big"==x){H={};for(var b=
z.zoomRange()[0],a=0;b<=z.zoomRange()[1];b++,a++)(H[b]=I.appendChild(t(b))).setAttribute("transform","translate(0,"+-(a+.75)*B*.4+")")}b="none"==F?.4:2;I.setAttribute("transform","translate(0,"+B*(/^top-/.test(O)?b+.4*(a+.5):-b)+")");I.appendChild(r(1)).setAttribute("transform","translate(0,"+-(a+.5)*B*.4+")");I.appendChild(r(-1)).setAttribute("transform","scale(-1)")}else I=null;C()}var w={},A=m.svg("g"),H={},B=30,E=16,G=0,O="top-left",x="small",I,F="small",D,q,J,v,L=m.svg("rect"),z,M,K;A.setAttribute("class",
"compass");L.setAttribute("class","back fore");L.setAttribute("pointer-events","none");L.setAttribute("display","none");w.radius=function(a){if(!arguments.length)return B;B=a;z&&u();return w};w.speed=function(a){if(!arguments.length)return B;E=a;return w};w.position=function(a){if(!arguments.length)return O;O=a;z&&u();return w};w.pan=function(a){if(!arguments.length)return F;F=a;z&&u();return w};w.zoom=function(a){if(!arguments.length)return x;x=a;z&&u();return w};w.map=function(b){if(!arguments.length)return z;
z&&(M.removeEventListener("mousedown",e,!1),M.removeChild(A),M=null,K.removeEventListener("mousemove",a,!1),K.removeEventListener("mouseup",d,!1),K=null,z.off("move",C).off("resize",C));if(z=b)M=z.svgContainer(),M.appendChild(A),M.addEventListener("mousedown",e,!1),K=M.ownerDocument.defaultView,K.addEventListener("mousemove",a,!1),K.addEventListener("mouseup",d,!1),z.on("move",C).on("resize",C),u();return w};return w};m.grid=function(){function c(b){b=a.firstChild;var c=e.size(),f=e.pointLocation(S);
e.pointLocation(c);var k=Math.pow(2,4-Math.round(e.zoom()));f.lat=Math.floor(f.lat/k)*k;f.lon=Math.ceil(f.lon/k)*k;for(var l;(l=e.locationPoint(f).x)<=c.x;f.lon+=k)b||(b=a.appendChild(m.svg("line"))),b.setAttribute("x1",l),b.setAttribute("x2",l),b.setAttribute("y1",0),b.setAttribute("y2",c.y),b=b.nextSibling;for(;(l=e.locationPoint(f).y)<=c.y;f.lat-=k)b||(b=a.appendChild(m.svg("line"))),b.setAttribute("y1",l),b.setAttribute("y2",l),b.setAttribute("x1",0),b.setAttribute("x2",c.x),b=b.nextSibling;for(;b;)c=
b.nextSibling,a.removeChild(b),b=c}var b={},e,a=m.svg("g");a.setAttribute("class","grid");b.map=function(d){if(!arguments.length)return e;e&&(a.parentNode.removeChild(a),e.off("move",c).off("resize",c));if(e=d)e.on("move",c).on("resize",c),e.svgContainer().appendChild(a),e.dispatch({type:"move"});return b};return b};m.attribution=function(c){var b={},e,a=document.createElement("div");a.setAttribute("class","mapsense-attribution");b.container=function(){return a};b.html=function(c){if(!arguments.length)return a.innerHTML;
a.innerHTML=c;return b};b.map=function(c){if(!arguments.length)return e;if(e){if(e===c)return a.parentNode.appendChild(a),b;a.parentNode.removeChild(a)}(e=c)&&e.relativeContainer().appendChild(a);return b};return b.html(c)};m.stylist=function(){function c(c){var g=c.features.length,f=b.length,k=e.length,l,p,h,n,r,t;for(r=0;r<g;++r)if(p=(l=c.features[r]).element){l=l.data;for(t=0;t<f;++t)n=(h=b[t]).value,"function"===typeof n&&(n=n.call(null,l)),null==n?h.name.local?p.removeAttributeNS(h.name.space,
h.name.local):p.removeAttribute(h.name):h.name.local?p.setAttributeNS(h.name.space,h.name.local,n):p.setAttribute(h.name,n);for(t=0;t<k;++t)n=(h=e[t]).value,"function"===typeof n&&(n=n.call(null,l)),null==n?p.style.removeProperty(h.name):p.style.setProperty(h.name,n,h.priority);if(n=a){for("function"===typeof n&&(n=n.call(null,l));p.lastChild;)p.removeChild(p.lastChild);null!=n&&p.appendChild(m.svg("title")).appendChild(document.createTextNode(n))}}}var b=[],e=[],a;c.attr=function(a,e){b.push({name:Y(a),
value:e});return c};c.style=function(a,b,f){e.push({name:a,value:b,priority:3>arguments.length?null:f});return c};c.title=function(b){a=b;return c};return c};"function"===typeof define&&define.amd?define(R):"object"===typeof module&&module.exports&&(module.exports=R);this.mapsense=R})();
