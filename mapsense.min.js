if(!mapsense)var mapsense={};
(function(q){function ha(g){var i=g.indexOf(":");return i<0?g:{space:q.ns[g.substring(0,i)],local:g.substring(i+1)}}function T(){for(var g=0;g<T.maps.length;g++)T.maps[g].resize()}function X(g){return 360/Math.PI*Math.atan(Math.exp(g*Math.PI/180))-90}function Y(g){return 180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360))}function aa(g,i){if(g.row>i.row){var a=g;g=i;i=a}return{x0:g.column,y0:g.row,x1:i.column,y1:i.row,dx:i.column-g.column,dy:i.row-g.row}}function ea(g,i,a,l,h){a=Math.max(a,Math.floor(i.y0));
l=Math.min(l,Math.ceil(i.y1));if(g.x0==i.x0&&g.y0==i.y0?g.x0+i.dy/g.dy*g.dx<i.x1:g.x1-i.dy/g.dy*g.dx<i.x0){var d=g;g=i;i=d}d=g.dx/g.dy;var c=i.dx/i.dy,j=g.dx>0,n=i.dx<0;for(a=a;a<l;a++){var m=d*Math.max(0,Math.min(g.dy,a+j-g.y0))+g.x0;h(Math.floor(c*Math.max(0,Math.min(i.dy,a+n-i.y0))+i.x0),Math.ceil(m),a)}}function fa(g,i,a,l,h,d){var c=aa(g,i);i=aa(i,a);g=aa(a,g);if(c.dy>i.dy){a=c;c=i;i=a}if(c.dy>g.dy){a=c;c=g;g=a}if(i.dy>g.dy){a=i;i=g;g=a}c.dy&&ea(g,c,l,h,d);i.dy&&ea(g,i,l,h,d)}q.version="1.0.0";
var Z={x:0,y:0};q.ns={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};q.id=function(){var g=0;return function(){return++g}}();q.svg=function(g){return document.createElementNS(q.ns.svg,g)};q.transform=function(g,i,a,l,h,d){var c={},j,n,m;if(!arguments.length){g=1;i=h=a=0;l=1;d=0}c.zoomFraction=function(k){if(!arguments.length)return n;n=k;j=Math.floor(n+Math.log(Math.sqrt(g*g+i*i+a*a+l*l))/Math.LN2);m=Math.pow(2,-j);return c};c.apply=function(k){var f=Math.pow(2,-k.zoom),p=
Math.pow(2,k.zoom-j);return{column:(g*k.column*f+a*k.row*f+h)*p,row:(i*k.column*f+l*k.row*f+d)*p,zoom:k.zoom-j}};c.unapply=function(k){var f=Math.pow(2,-k.zoom),p=Math.pow(2,k.zoom+j);return{column:(k.column*f*l-k.row*f*a-h*l+d*a)/(g*l-i*a)*p,row:(k.column*f*i-k.row*f*g-h*i+d*g)/(a*i-l*g)*p,zoom:k.zoom+j}};c.toString=function(){return"matrix("+[g*m,i*m,a*m,l*m].join(" ")+" 0 0)"};return c.zoomFraction(0)};q.cache=function(g,i){function a(f){k--;i&&i(f);delete c[f.key];if(f.next)f.next.prev=f.prev;
else if(n=f.prev)n.next=null;if(f.prev)f.prev.next=f.next;else if(j=f.next)j.prev=null}function l(){for(var f=n;k>m;f=f.prev){if(!f)break;f.lock||a(f)}}var h={},d={},c={},j=null,n=null,m=64,k=0;h.peek=function(f){return c[[f.zoom,f.column,f.row].join("/")]};h.load=function(f,p){var u=[f.zoom,f.column,f.row].join("/"),v=c[u];if(v){if(v.prev){if(v.prev.next=v.next)v.next.prev=v.prev;else n=v.prev;v.prev=null;v.next=j;j=j.prev=v}v.lock=1;return d[u]=v}v={key:u,column:f.column,row:f.row,zoom:f.zoom,next:j,
prev:null,lock:1};g.call(null,v,p);d[u]=c[u]=v;if(j)j.prev=v;else n=v;j=v;k++;return v};h.unload=function(f){if(!(f in d))return false;var p=d[f];p.lock=0;delete d[f];p.request&&p.request.abort(false)&&a(p);return p};h.locks=function(){return d};h.size=function(f){if(!arguments.length)return m;m=f;l();return h};h.flush=function(){l();return h};h.clear=function(){for(var f in c){var p=c[f];p.request&&p.request.abort(false);i&&i(c[f]);if(p.lock){p.lock=0;p.element.parentNode.removeChild(p.element)}}d=
{};c={};j=n=null;k=0;return h};return h};q.url=function(g){function i(h){var d=h.zoom<0?1:1<<h.zoom,c=h.column;if(l){c=h.column%d;if(c<0)c+=d}else if(c<0||c>=d)return null;return g.replace(/{(.)}/g,function(j,n){switch(n){case "S":return a[(Math.abs(h.zoom)+h.row+c)%a.length];case "Z":return h.zoom;case "X":return c;case "Y":return h.row;case "B":var m=q.map.coordinateLocation({row:h.row,column:c,zoom:h.zoom}),k=q.map.coordinateLocation({row:h.row+1,column:c+1,zoom:h.zoom}),f=Math.ceil(Math.log(h.zoom)/
Math.LN2);return k.lat.toFixed(f)+","+m.lon.toFixed(f)+","+m.lat.toFixed(f)+","+k.lon.toFixed(f)}return n})}var a=[],l=true;i.template=function(h){if(!arguments.length)return g;g=h;return i};i.hosts=function(h){if(!arguments.length)return a;a=h;return i};i.repeat=function(h){if(!arguments.length)return l;l=h;return i};return i};q.dispatch=function(g){var i={};g.on=function(a,l){for(var h=i[a]||(i[a]=[]),d=0;d<h.length;d++)if(h[d].handler==l)return g;h.push({handler:l,on:true});return g};g.off=function(a,
l){var h=i[a];if(h)for(var d=0;d<h.length;d++){var c=h[d];if(c.handler==l){c.on=false;h.splice(d,1);break}}return g};return function(a){var l=i[a.type];if(l){l=l.slice();for(var h=0;h<l.length;h++){var d=l[h];d.on&&d.handler.call(g,a)}}}};q.queue=function(){function g(){if(!(h>=d||!l.length)){h++;l.pop()()}}function i(c){for(var j=0;j<l.length;j++)if(l[j]==c){l.splice(j,1);return true}return false}function a(c,j,n,m){function k(){f=new XMLHttpRequest;f.open("GET",c,true);n&&f.overrideMimeType&&f.overrideMimeType(n);
if(m)f.responseType=m;f.onreadystatechange=function(){if(f.readyState==4){h--;f.status<300&&j(f);g()}};f.send(null)}var f;l.push(k);g();return{abort:function(p){if(i(k))return true;if(p&&f){f.abort();return true}return false}}}var l=[],h=0,d=6;return{text:function(c,j,n){return a(c,function(m){m.responseText&&j(m.responseText)},n)},xml:function(c,j){return a(c,function(n){n.responseXML&&j(n.responseXML)},"application/xml")},json:function(c,j){return a(c,function(n){n.responseText&&j(JSON.parse(n.responseText))},
"application/json")},octetStream:function(c,j){return a(c,function(n){n.response&&j(n.response)},"application/octet-stream","arraybuffer")},image:function(c,j,n){function m(){k=document.createElement("img");k.onerror=function(){h--;g()};k.onload=function(){h--;n(k);g()};k.src=j;c.setAttributeNS(q.ns.xlink,"href",j)}var k;l.push(m);g();return{abort:function(f){if(i(m))return true;if(f&&k){k.src="about:";return true}return false}}}}}();q.map=function(){function g(){if(p)if(m<p[0])m=p[0];else if(m>p[1])m=
p[1];k=m-(m=Math.round(m));f=Math.pow(2,k)}function i(){if(A){var e=45/Math.pow(2,m+k-3),o=Math.max(Math.abs(x*c.x+v*c.y),Math.abs(w*c.x+C*c.y)),r=X(J-o*e/j.y);o=X(D+o*e/j.y);n.lat=Math.max(r,Math.min(o,n.lat));r=Math.max(Math.abs(x*c.y+v*c.x),Math.abs(w*c.y+C*c.x));n.lon=Math.max(A[0].lon-r*e/j.x,Math.min(A[1].lon+r*e/j.x,n.lon))}}var a={},l,h,d=Z,c=Z,j={x:256,y:256},n={lat:37.76487,lon:-122.41948},m=12,k=0,f=1,p=[1,18],u=0,v=1,x=0,C=1,w=0,J=-180,D=180,A=[{lat:X(J),lon:-Infinity},{lat:X(D),lon:Infinity}];
a.locationCoordinate=function(e){e=q.map.locationCoordinate(e);var o=Math.pow(2,m);e.column*=o;e.row*=o;e.zoom+=m;return e};a.coordinateLocation=q.map.coordinateLocation;a.coordinatePoint=function(e,o){var r=Math.pow(2,m-o.zoom),y=Math.pow(2,m-e.zoom),z=(o.column*r-e.column*y)*j.x*f;r=(o.row*r-e.row*y)*j.y*f;return{x:c.x+v*z-x*r,y:c.y+x*z+v*r}};a.pointCoordinate=function(e,o){var r=Math.pow(2,m-e.zoom),y=(o.x-c.x)/f,z=(o.y-c.y)/f;return{column:e.column*r+(C*y-w*z)/j.x,row:e.row*r+(w*y+C*z)/j.y,zoom:m}};
a.locationPoint=function(e){var o=Math.pow(2,m+k-3)/45,r=(e.lon-n.lon)*o*j.x;e=(Y(n.lat)-Y(e.lat))*o*j.y;return{x:c.x+v*r-x*e,y:c.y+x*r+v*e}};a.pointLocation=function(e){var o=45/Math.pow(2,m+k-3),r=(e.x-c.x)*o;e=(e.y-c.y)*o;return{lon:n.lon+(C*r-w*e)/j.x,lat:X(Y(n.lat)-(w*r+C*e)/j.y)}};var G=q.svg("rect");G.setAttribute("visibility","hidden");G.setAttribute("pointer-events","all");a.container=function(e){if(!arguments.length)return l;l=e;l.setAttribute("class","map");l.appendChild(G);return a.resize()};
a.focusableParent=function(){for(var e=l;e;e=e.parentNode)if(e.tabIndex>=0)return e;return window};a.mouse=function(e){var o=(l.ownerSVGElement||l).createSVGPoint();if(ba<0&&(window.scrollX||window.scrollY)){var r=document.body.appendChild(q.svg("svg"));r.style.position="absolute";r.style.top=r.style.left="0px";var y=r.getScreenCTM();ba=!(y.f||y.e);document.body.removeChild(r)}if(ba){o.x=e.pageX;o.y=e.pageY}else{o.x=e.clientX;o.y=e.clientY}return o.matrixTransform(l.getScreenCTM().inverse())};a.size=
function(e){if(!arguments.length)return d;h=e;return a.resize()};a.resize=function(){if(h){d=h;T.remove(a)}else{G.setAttribute("width","100%");G.setAttribute("height","100%");b=G.getBBox();d={x:b.width,y:b.height};T.add(a)}G.setAttribute("width",d.x);G.setAttribute("height",d.y);c={x:d.x/2,y:d.y/2};i();a.dispatch({type:"resize"});return a};a.tileSize=function(e){if(!arguments.length)return j;j=e;a.dispatch({type:"move"});return a};a.center=function(e){if(!arguments.length)return n;n=e;i();a.dispatch({type:"move"});
return a};a.panBy=function(e){var o=45/Math.pow(2,m+k-3),r=e.x*o;e=e.y*o;return a.center({lon:n.lon+(w*e-C*r)/j.x,lat:X(Y(n.lat)+(w*r+C*e)/j.y)})};a.centerRange=function(e){if(!arguments.length)return A;if(A=e){J=A[0].lat>-90?Y(A[0].lat):-Infinity;D=A[0].lat<90?Y(A[1].lat):Infinity}else{J=-Infinity;D=Infinity}i();a.dispatch({type:"move"});return a};a.zoom=function(e){if(!arguments.length)return m+k;m=e;g();return a.center(n)};a.zoomBy=function(e,o,r){if(arguments.length<2)return a.zoom(m+k+e);if(arguments.length<
3)r=a.pointLocation(o);m=m+k+e;g();var y=a.locationPoint(r);return a.panBy({x:o.x-y.x,y:o.y-y.y})};a.zoomRange=function(e){if(!arguments.length)return p;p=e;return a.zoom(m+k)};a.extent=function(e){if(!arguments.length)return[a.pointLocation({x:0,y:d.y}),a.pointLocation({x:d.x,y:0})];var o=a.locationPoint(e[0]),r=a.locationPoint(e[1]),y=Math.max((r.x-o.x)/d.x,(o.y-r.y)/d.y);o=a.pointLocation({x:(o.x+r.x)/2,y:(o.y+r.y)/2});m=m+k-Math.log(y)/Math.LN2;g();return a.center(o)};a.angle=function(e){if(!arguments.length)return u;
u=e;v=Math.cos(u);x=Math.sin(u);C=Math.cos(-u);w=Math.sin(-u);i();a.dispatch({type:"move"});return a};a.add=function(e){e.map(a);return a};a.remove=function(e){e.map(null);return a};a.dispatch=q.dispatch(a);return a};T.maps=[];T.add=function(g){for(var i=0;i<T.maps.length;i++)if(T.maps[i]==g)return;T.maps.push(g)};T.remove=function(g){for(var i=0;i<T.maps.length;i++)if(T.maps[i]==g){T.maps.splice(i,1);return}};if(window.addEventListener){window.addEventListener("resize",T,false);window.addEventListener("load",
T,false)}q.map.locationCoordinate=function(g){var i=1/360;return{column:(g.lon+180)*i,row:(180-Y(g.lat))*i,zoom:0}};q.map.coordinateLocation=function(g){var i=45/Math.pow(2,g.zoom-3);return{lon:i*g.column-180,lat:X(180-i*g.row)}};var ba=/WebKit/.test(navigator.userAgent)?-1:0;q.layer=function(g,i){function a(w){for(var J=x[0].nextSibling;v<w;v++){p.insertBefore(x[-4],J);p.insertBefore(x[2],J);p.insertBefore(x[1],J);for(var D=x[-4],A=-4;A<2;)x[A]=x[++A];x[A]=D}}function l(w){for(var J=x[0].nextSibling;v>
w;v--){p.insertBefore(x[-1],J);p.insertBefore(x[2],x[-4]);for(var D=x[2],A=2;A>-4;)x[A]=x[--A];x[A]=D}}function h(){function w(s){var B=s.zoom,K=B<0?1:1<<B,H=s.column%K,N=s.row;if(H<0)H+=K;return{locationPoint:function(Q){Q=q.map.locationCoordinate(Q);var R=Math.pow(2,B-Q.zoom);return{x:y.x*(R*Q.column-H),y:y.y*(R*Q.row-N)}}}}function J(s,B,K){var H=I.zoom,N=2-O,Q=4+O;for(s=s;s<B;s++){var R=c.load({column:s,row:K,zoom:H},w);if(!R.ready&&!(R.key in E)){R.proxyRefs={};for(var W,$,U,V=1;V<=N;V++){$=
true;for(var ca=0,ga=1<<V;ca<=ga;ca++)for(var da=0;da<=ga;da++)if((U=c.peek(W={column:(s<<V)+da,row:(K<<V)+ca,zoom:H+V}))&&U.ready){E[U.key]=c.load(W);U.proxyCount++;R.proxyRefs[U.key]=U}else $=false;if($)break}if(!$)for(V=1;V<=Q;V++)if((U=c.peek(W={column:s>>V,row:K>>V,zoom:H-V}))&&U.ready){E[U.key]=c.load(W);U.proxyCount++;R.proxyRefs[U.key]=U;break}}E[R.key]=R}}function D(s){return Math.round(s*256)/256}var A=d.map(),G=A.zoom(),e=G-(G=Math.round(G)),o=A.size(),r=A.angle(),y=A.tileSize(),z=A.locationCoordinate(A.center());
if(v!=G){if(v<G)a(G);else if(v>G)l(G);else v=G;for(var t=-4;t<=2;t++){var M=x[t];M.setAttribute("class","zoom"+(t<0?"":"+")+t+" zoom"+(G+t));M.setAttribute("transform","scale("+Math.pow(2,-t)+")")}}var I=A.pointCoordinate(z,Z);t=A.pointCoordinate(z,{x:o.x,y:0});G=A.pointCoordinate(z,o);A=A.pointCoordinate(z,{x:0,y:o.y});M=z.column;var P=z.row;z.column=Math.round((Math.round(y.x*z.column)+(o.x&1)/2)/y.x);z.row=Math.round((Math.round(y.y*z.row)+(o.y&1)/2)/y.y);M-=z.column;P-=z.row;var L=D(Math.pow(2,
e));p.setAttribute("transform","translate("+Math.round(o.x/2-M*y.x*L)+","+Math.round(o.y/2-P*y.y*L)+")"+(r?"rotate("+r/Math.PI*180+")":"")+(e?"scale("+L+")":"")+(F?F.zoomFraction(e):""));if(F){I=F.unapply(I);t=F.unapply(t);G=F.unapply(G);A=F.unapply(A);z=F.unapply(z)}var O=m?m(I.zoom)-I.zoom:0;if(O){F=Math.pow(2,O);I.column*=F;I.row*=F;t.column*=F;t.row*=F;G.column*=F;G.row*=F;A.column*=F;A.row*=F;I.zoom=t.zoom=G.zoom=A.zoom+=O}e=c.locks();var E={};for(var S in e)e[S].proxyCount=0;if(n&&O>-5&&O<3){o=
I.zoom<0?1:1<<I.zoom;if(j){fa(I,t,G,0,o,J);fa(G,A,I,0,o,J)}else{F=Math.floor((I.column+G.column)/2);o=Math.max(0,Math.min(o-1,Math.floor((t.row+A.row)/2)));t=Math.min(4,I.zoom);F=F>>t<<t;o=o>>t<<t;J(F,F+1,o)}}for(S in E){t=E[S];F=D(Math.pow(2,t.level=t.zoom-z.zoom));var F="translate("+Math.round(t.x=y.x*(t.column-z.column*F))+"px,"+Math.round(t.y=y.y*(t.row-z.row*F))+"px)";d3.select(t.element).style("transform",F);d3.select(t.element).style("-webkit-transform",F);d3.select(t.element).style("-ms-transform",
F)}for(S in e)if(!(S in E)){t=c.unload(S);t.element.parentNode.removeChild(t.element);delete t.proxyRefs}for(S in E){t=E[S];if(t.element.parentNode!=x[t.level]){x[t.level].appendChild(t.element);d.show&&d.show(t)}}c.flush();d.dispatch({type:"move"})}var d={},c=d.cache=q.cache(g,i).size(512),j=true,n=true,m,k,f,p=q.svg("g"),u,v,x={};p.setAttribute("class","layer");for(var C=-4;C<=-1;C++)x[C]=p.appendChild(q.svg("g"));for(C=2;C>=1;C--)x[C]=p.appendChild(q.svg("g"));x[0]=p.appendChild(q.svg("g"));d.map=
function(w){if(!arguments.length)return f;if(f){if(f==w){p.parentNode.appendChild(p);return d}f.off("move",h).off("resize",h);p.parentNode.removeChild(p)}if(f=w){f.container().appendChild(p);d.init&&d.init(p);f.on("move",h).on("resize",h);h()}return d};d.container=function(){return p};d.levels=function(){return x};d.id=function(w){if(!arguments.length)return k;k=w;p.setAttribute("id",w);return d};d.visible=function(w){if(!arguments.length)return n;(n=w)?p.removeAttribute("visibility"):p.setAttribute("visibility",
"hidden");f&&h();return d};d.transform=function(w){if(!arguments.length)return u;u=w;f&&h();return d};d.zoom=function(w){if(!arguments.length)return m;m=typeof w=="function"||w==null?w:function(){return w};f&&h();return d};d.tile=function(w){if(!arguments.length)return j;j=w;f&&h();return d};d.reload=function(){c.clear();f&&h();return d};d.dispatch=q.dispatch(d);d.on("load",function(w){if(w.tile.proxyRefs){for(var J in w.tile.proxyRefs){var D=w.tile.proxyRefs[J];--D.proxyCount<=0&&c.unload(J)&&D.element.parentNode.removeChild(D.element)}delete w.tile.proxyRefs}});
return d};q.image=function(){var g=q.layer(function(a){var l=a.element=q.svg("image"),h=g.map().tileSize();l.setAttribute("preserveAspectRatio","none");l.setAttribute("width",h.x);l.setAttribute("height",h.y);if(typeof i=="function"){l.setAttribute("opacity",0);h=i(a);if(h!=null)a.request=q.queue.image(l,h,function(d){delete a.request;a.ready=true;a.img=d;l.removeAttribute("opacity");g.dispatch({type:"load",tile:a})});else{a.ready=true;g.dispatch({type:"load",tile:a})}}else{a.ready=true;i!=null&&
l.setAttributeNS(q.ns.xlink,"href",i);g.dispatch({type:"load",tile:a})}},function(a){a.request&&a.request.abort(true)}),i;g.url=function(a){if(!arguments.length)return i;i=typeof a=="string"&&/{.}/.test(a)?q.url(a):a;return g.reload()};return g};q.geoJson=function(g){function i(e,o,r){return e.type in D&&D[e.type](e,o,r)}function a(e){return d3.geo.path().projection({stream:function(o){return{point:function(r,y){var z=e.locationPoint({lon:r,lat:y});o.point(Math.round(2*z.x)/2,Math.round(2*z.y)/2)},
sphere:function(){o.sphere()},lineStart:function(){o.lineStart()},lineEnd:function(){o.lineEnd()},polygonStart:function(){o.polygonStart()},polygonEnd:function(){o.polygonEnd()}}}})}function l(e){var o=Math.pow(2,e.zoom),r=c.map().tileSize(),y=o*r.x/4.00750166856E7;r=o*r.y/4.00750166856E7;var z=(o/2-e.column)*4.00750166856E7/o;e=(o/2-e.row)*4.00750166856E7/o;return d3.geo.path().projection(function(t,M,I,P){return d3.geo.transform({point:function(L,O){this.stream.point(t*(L-I),M*(O-P))}})}(y,r,-z,
-e))}function h(e,o,r,y){e=d3.select(e).selectAll("path").data(o.features);e.exit().remove();o=e.enter().append("path");y&&o.each(function(t){y.push({element:this,data:t})});J&&J(e);var z=[];e.each(function(t,M){z[M]=r(t)});e.attr("d",function(t,M){return z[M]})}function d(){var e=c.map().zoom(),o=c.cache.locks(),r,y,z,t,M,I,P;if(v=="fixed")for(r in o){if((y=o[r]).scale!=e){P="scale("+Math.pow(2,y.zoom-e)+")";t=-1;for(M=(z=y.features).length;++t<M;)i((I=z[t]).data.geometry,I.element,P);y.scale=e}}else for(r in o){t=
-1;for(M=(z=(y=o[r]).features).length;++t<M;)i((I=z[t]).data.geometry,I.element,"");delete y.scale}}var c=q.layer(function(e,o){function r(M){var I=[];if(M.next)e.request=g(M.next.href,r);if(c.tile()&&C){var P=c.map().tileSize();d3.select(y.insertBefore(q.svg("rect"),y.firstChild)).attr("width",P.x).attr("height",P.x).attr("class","tile-background")}h(y,M,t,I,e);e.ready=true;I.push.apply(e.features,I);c.dispatch({type:"load",tile:e,features:I})}var y=e.element=q.svg("g"),z=o(e),t=w?l(e):a(z);e.features=
[];if(n!=null)e.request=g(typeof n=="function"?n(e):n,r);else r({type:"FeatureCollection",features:x||[]})},function(e){e.request&&e.request.abort(true)}),j=c.container(),n,m=true,k="org.polymaps."+q.id(),f="url(#"+k+")",p=j.insertBefore(q.svg("clipPath"),j.firstChild),u=p.appendChild(q.svg("rect")),v="auto",x,C=true,w=false,J;j.setAttribute("fill-rule","evenodd");p.setAttribute("id",k);if(!arguments.length)g=q.queue.json;var D={Point:function(e,o,r){e=e.coordinates;o.setAttribute("transform","translate("+
e.x+","+e.y+")"+r)},MultiPoint:function(e,o,r){e=e.coordinates;var y=-1,z=t.length;o=o.firstChild;for(var t;++y<z;){t=e[y];o.setAttribute("transform","translate("+t.x+","+t.y+")"+r);o=o.nextSibling}}};c.tileBackground=function(e){if(!arguments.length)return C;C=e;return c};c.mercatorSource=function(e){if(!arguments.length)return w;w=e;return c};c.selection=function(e){if(!arguments.length)return J;J=e;return c.reshow()};c.url=function(e){if(!arguments.length)return n;n=typeof e=="string"&&/{.}/.test(e)?
q.url(e):e;if(n!=null)x=null;typeof n=="string"&&c.tile(false);return c.reload()};c.features=function(e){if(!arguments.length)return x;if(x=e){n=null;c.tile(false)}return c.reload()};c.clip=function(e){if(!arguments.length)return m;m&&j.removeChild(p);if(m=e)j.insertBefore(p,j.firstChild);var o=c.cache.locks();for(var r in o)m?o[r].element.setAttribute("clip-path",f):o[r].element.removeAttribute("clip-path");return c};var A=c.tile;c.tile=function(e){arguments.length&&!e&&c.clip(e);return A.apply(c,
arguments)};var G=c.map;c.map=function(e){if(e&&u){var o=e.tileSize();u.setAttribute("width",o.x);u.setAttribute("height",o.y)}return G.apply(c,arguments)};c.scale=function(e){if(!arguments.length)return v;(v=e)?c.on("move",d):c.off("move",d);c.map()&&d();return c};c.show=function(e){m?e.element.setAttribute("clip-path",f):e.element.removeAttribute("clip-path");J&&J(d3.select(e.element).selectAll("path"));c.dispatch({type:"show",tile:e,features:e.features});return c};c.reshow=function(){var e=c.cache.locks();
for(var o in e)c.show(e[o]);return c};return c};q.topoJson=function(g){function i(c){if(!a)return c;var j={},n=[];c.forEach(function(m){var k=a(m),f=j[k];if(f===undefined){f=n.push([])-1;j[k]=f}n[f].push(m)});return n.map(function(m){return{type:"GeometryCollection",geometries:m}})}if(!arguments.length)g=q.queue.json;var a,l,h=function(c){function j(k,f,p,u){if(f.type=="GeometryCollection"&&!f.properties)f.geometries.forEach(function(x){j(k,x,p,u)});else{var v=topojson.feature(k,f);v.properties={layer:p};
f.properties&&Object.keys(f.properties).forEach(function(x){v.properties[x]=f.properties[x]});u.push(v)}}var n=[];for(var m in c.objects)j(c,c.objects[m],m,n);return n=i(n)},d=q.geoJson(function(c,j){return g(c,function(n){j({type:"FeatureCollection",features:h(n)})})});d.topologyFeatures=function(c){if(!arguments.length)return h;h=c;return d};d.classify=function(c){if(!arguments.length)return a;a=c;return d};d.staticTopology=function(c){if(!arguments.length)return l;l=c;return d.features(l?h(l):
null)};return d};q.dblclick=function(){function g(d){var c=l.zoom();c=d.shiftKey?Math.ceil(c)-c-1:1-c+Math.floor(c);a==="mouse"?l.zoomBy(c,l.mouse(d)):l.zoomBy(c)}var i={},a="mouse",l,h;i.zoom=function(d){if(!arguments.length)return a;a=d;return i};i.map=function(d){if(!arguments.length)return l;if(l){h.removeEventListener("dblclick",g,false);h=null}if(l=d){h=l.container();h.addEventListener("dblclick",g,false)}return i};return i};q.drag=function(){function g(c){if(!c.shiftKey){d={x:c.clientX,y:c.clientY};
l.focusableParent().focus();c.preventDefault();document.body.style.setProperty("cursor","move",null)}}function i(c){if(d){l.panBy({x:c.clientX-d.x,y:c.clientY-d.y});d.x=c.clientX;d.y=c.clientY}}var a={},l,h,d;a.map=function(c){if(!arguments.length)return l;if(l){h.removeEventListener("mousedown",g,false);h=null}if(l=c){h=l.container();h.addEventListener("mousedown",g,false)}return a};window.addEventListener("mousemove",i,false);window.addEventListener("mouseup",function(c){if(d){i(c);d=null;document.body.style.removeProperty("cursor")}},
false);return a};q.wheel=function(){function g(){c=null}function i(f){var p=f.wheelDelta||-f.detail,u;if(p)if(h){try{k.scrollTop=1E3;k.dispatchEvent(f);p=1E3-k.scrollTop}catch(v){}p*=0.001}else{u=Date.now();if(u-l>200){p=p>0?+1:-1;l=u}else p=0}if(p)switch(d){case "mouse":u=j.mouse(f);c||(c=j.pointLocation(u));j.off("move",g).zoomBy(p,u,c).on("move",g);break;case "location":j.zoomBy(p,j.locationPoint(c),c);break;default:j.zoomBy(p);break}f.preventDefault();return false}var a={},l=0,h=true,d="mouse",
c,j,n,m=document.createElement("div"),k=document.createElement("div");k.style.visibility="hidden";k.style.top="0px";k.style.height="0px";k.style.width="0px";k.style.overflowY="scroll";m.style.height="2000px";k.appendChild(m);document.body.appendChild(k);a.smooth=function(f){if(!arguments.length)return h;h=f;return a};a.zoom=function(f,p){if(!arguments.length)return d;d=f;c=p;if(j)d=="mouse"?j.on("move",g):j.off("move",g);return a};a.map=function(f){if(!arguments.length)return j;if(j){n.removeEventListener("mousemove",
g,false);n.removeEventListener("mousewheel",i,false);n.removeEventListener("MozMousePixelScroll",i,false);n=null;j.off("move",g)}if(j=f){d=="mouse"&&j.on("move",g);n=j.container();n.addEventListener("mousemove",g,false);n.addEventListener("mousewheel",i,false);n.addEventListener("MozMousePixelScroll",i,false)}return a};return a};q.arrow=function(){function g(u){if(!(u.ctrlKey||u.altKey||u.metaKey)){var v=Date.now(),x=0,C=0;switch(u.keyCode){case 37:if(!d.left){c=v;d.left=1;d.right||(x=k)}break;case 39:if(!d.right){c=
v;d.right=1;d.left||(x=-k)}break;case 38:if(!d.up){c=v;d.up=1;d.down||(C=k)}break;case 40:if(!d.down){c=v;d.down=1;d.up||(C=-k)}break;default:return}if(x||C)f.panBy({x:x,y:C});if(!j&&d.left|d.right|d.up|d.down)j=setInterval(l,m);u.preventDefault()}}function i(u){c=Date.now();switch(u.keyCode){case 37:d.left=0;break;case 39:d.right=0;break;case 38:d.up=0;break;case 40:d.down=0;break;default:return}if(j&&!(d.left|d.right|d.up|d.down))j=clearInterval(j);u.preventDefault()}function a(u){switch(u.charCode){case 45:case 95:f.zoom(Math.ceil(f.zoom())-
1);break;case 43:case 61:f.zoom(Math.floor(f.zoom())+1);break;default:return}u.preventDefault()}function l(){if(f)if(!(Date.now()<c+n)){var u=(d.left-d.right)*k,v=(d.up-d.down)*k;if(u||v)f.panBy({x:u,y:v})}}var h={},d={left:0,right:0,up:0,down:0},c=0,j,n=250,m=50,k=16,f,p;h.map=function(u){if(!arguments.length)return f;if(f){p.removeEventListener("keypress",a,false);p.removeEventListener("keydown",g,false);p.removeEventListener("keyup",i,false);p=null}if(f=u){p=f.focusableParent();p.addEventListener("keypress",
a,false);p.addEventListener("keydown",g,false);p.addEventListener("keyup",i,false)}return h};h.speed=function(u){if(!arguments.length)return k;k=u;return h};return h};q.hash=function(){function g(){var j=c(h);if(l!==j)location.replace(l=j)}function i(){if(location.hash!==l)if(d(h,(l=location.hash).substring(1)))g()}var a={},l,h,d=function(j,n){var m=n.split("/").map(Number);if(m.length<3||m.some(isNaN))return true;else{var k=j.size();j.zoomBy(m[0]-j.zoom(),{x:k.x/2,y:k.y/2},{lat:Math.min(89.99999999,
Math.max(-89.99999999,m[1])),lon:m[2]})}},c=function(j){var n=j.center();j=j.zoom();var m=Math.max(0,Math.ceil(Math.log(j)/Math.LN2));return"#"+j.toFixed(2)+"/"+n.lat.toFixed(m)+"/"+n.lon.toFixed(m)};a.map=function(j){if(!arguments.length)return h;if(h){h.off("move",g);window.removeEventListener("hashchange",i,false)}if(h=j){h.on("move",g);window.addEventListener("hashchange",i,false);location.hash?i():g()}return a};a.parser=function(j){if(!arguments.length)return d;d=j;return a};a.formatter=function(j){if(!arguments.length)return c;
c=j;return a};return a};q.touch=function(){function g(m){var k=-1,f=m.touches.length,p=Date.now();if(f==1&&p-d<300){var u=a.zoom();a.zoomBy(1-u+Math.floor(u),a.mouse(m.touches[0]));m.preventDefault()}d=p;c=a.zoom();for(j=a.angle();++k<f;){p=m.touches[k];n[p.identifier]=a.pointLocation(a.mouse(p))}}var i={},a,l,h=false,d=0,c,j,n={};window.addEventListener("touchmove",function(m){switch(m.touches.length){case 1:var k=m.touches[0];a.zoomBy(0,a.mouse(k),n[k.identifier]);m.preventDefault();break;case 2:k=
m.touches[0];var f=m.touches[1],p=a.mouse(k),u=a.mouse(f);p={x:(p.x+u.x)/2,y:(p.y+u.y)/2};k=q.map.locationCoordinate(n[k.identifier]);f=q.map.locationCoordinate(n[f.identifier]);f=q.map.coordinateLocation({row:(k.row+f.row)/2,column:(k.column+f.column)/2,zoom:0});a.zoomBy(Math.log(m.scale)/Math.LN2+c-a.zoom(),p,f);h&&a.angle(m.rotation/180*Math.PI+j);m.preventDefault();break}},false);i.rotate=function(m){if(!arguments.length)return h;h=m;return i};i.map=function(m){if(!arguments.length)return a;if(a){l.removeEventListener("touchstart",
g,false);l=null}if(a=m){l=a.container();l.addEventListener("touchstart",g,false)}return i};return i};q.interact=function(){var g={},i=q.drag(),a=q.wheel(),l=q.dblclick(),h=q.touch(),d=q.arrow();g.map=function(c){i.map(c);a.map(c);l.map(c);h.map(c);d.map(c);return g};return g};q.compass=function(){function g(s){w.setAttribute("class","compass active");M||(M=setInterval(i,o));I&&E.panBy(I);G=Date.now();return k(s)}function i(){I&&Date.now()>G+e&&E.panBy(I)}function a(s){if(s.shiftKey){L={x0:E.mouse(s)};
E.focusableParent().focus();return k(s)}}function l(s){if(L){L.x1=E.mouse(s);O.setAttribute("x",Math.min(L.x0.x,L.x1.x));O.setAttribute("y",Math.min(L.x0.y,L.x1.y));O.setAttribute("width",Math.abs(L.x0.x-L.x1.x));O.setAttribute("height",Math.abs(L.x0.y-L.x1.y));O.removeAttribute("display")}}function h(){w.setAttribute("class","compass");if(L){if(L.x1){E.extent([E.pointLocation({x:Math.min(L.x0.x,L.x1.x),y:Math.max(L.x0.y,L.x1.y)}),E.pointLocation({x:Math.max(L.x0.x,L.x1.x),y:Math.min(L.x0.y,L.x1.y)})]);
O.setAttribute("display","none")}L=null}if(M){clearInterval(M);M=0}}function d(s){return function(){s?this.setAttribute("class","active"):this.removeAttribute("class");I=s}}function c(s){return function(B){w.setAttribute("class","compass active");var K=E.zoom();E.zoom(s<0?Math.ceil(K)-1:Math.floor(K)+1);return k(B)}}function j(s){return function(B){E.zoom(s);return k(B)}}function n(){this.setAttribute("class","active")}function m(){this.removeAttribute("class")}function k(s){s.stopPropagation();s.preventDefault();
return false}function f(s){var B=Math.SQRT1_2*D,K=D*0.7,H=D*0.2,N=q.svg("g"),Q=N.appendChild(q.svg("path")),R=N.appendChild(q.svg("path"));Q.setAttribute("class","direction");Q.setAttribute("pointer-events","all");Q.setAttribute("d","M0,0L"+B+","+B+"A"+D+","+D+" 0 0,1 "+-B+","+B+"Z");R.setAttribute("class","chevron");R.setAttribute("d","M"+H+","+(K-H)+"L0,"+K+" "+-H+","+(K-H));R.setAttribute("pointer-events","none");N.addEventListener("mousedown",g,false);N.addEventListener("mouseover",d(s),false);
N.addEventListener("mouseout",d(null),false);N.addEventListener("dblclick",k,false);return N}function p(s){var B=D*0.4,K=B/2,H=q.svg("g"),N=H.appendChild(q.svg("path")),Q=H.appendChild(q.svg("path")),R=H.appendChild(q.svg("path")),W=H.appendChild(q.svg("path"));N.setAttribute("class","back");N.setAttribute("d","M"+-B+",0V"+-B+"A"+B+","+B+" 0 1,1 "+B+","+-B+"V0Z");Q.setAttribute("class","direction");Q.setAttribute("d",N.getAttribute("d"));R.setAttribute("class","chevron");R.setAttribute("d","M"+-K+
","+-B+"H"+K+(s>0?"M0,"+(-B-K)+"V"+-K:""));W.setAttribute("class","fore");W.setAttribute("fill","none");W.setAttribute("d",N.getAttribute("d"));H.addEventListener("mousedown",c(s),false);H.addEventListener("mouseover",n,false);H.addEventListener("mouseout",m,false);H.addEventListener("dblclick",k,false);return H}function u(s){var B=D*0.2,K=D*0.4,H=q.svg("g"),N=H.appendChild(q.svg("rect")),Q=H.appendChild(q.svg("path"));N.setAttribute("pointer-events","all");N.setAttribute("fill","none");N.setAttribute("x",
-K);N.setAttribute("y",-0.75*K);N.setAttribute("width",2*K);N.setAttribute("height",1.5*K);Q.setAttribute("class","chevron");Q.setAttribute("d","M"+-B+",0H"+B);H.addEventListener("mousedown",j(s),false);H.addEventListener("dblclick",k,false);return H}function v(){var s=D+6,B=s,K=E.size();switch(r){case "top-left":break;case "top-right":s=K.x-s;break;case "bottom-left":B=K.y-B;break;case "bottom-right":s=K.x-s;B=K.y-B;break}w.setAttribute("transform","translate("+s+","+B+")");O.setAttribute("transform",
"translate("+-s+","+-B+")");for(var H in J)H==E.zoom()?J[H].setAttribute("class","active"):J[H].removeAttribute("class")}function x(){for(;w.lastChild;)w.removeChild(w.lastChild);w.appendChild(O);if(t!="none"){P=w.appendChild(q.svg("g"));P.setAttribute("class","pan");var s=P.appendChild(q.svg("circle"));s.setAttribute("class","back");s.setAttribute("r",D);P.appendChild(f({x:0,y:-A})).setAttribute("transform","rotate(0)");P.appendChild(f({x:A,y:0})).setAttribute("transform","rotate(90)");P.appendChild(f({x:0,
y:A})).setAttribute("transform","rotate(180)");P.appendChild(f({x:-A,y:0})).setAttribute("transform","rotate(270)");s=P.appendChild(q.svg("circle"));s.setAttribute("fill","none");s.setAttribute("class","fore");s.setAttribute("r",D)}else P=null;if(y!="none"){z=w.appendChild(q.svg("g"));z.setAttribute("class","zoom");s=-0.5;if(y=="big"){J={};var B=E.zoomRange()[0];for(s=0;B<=E.zoomRange()[1];B++,s++)(J[B]=z.appendChild(u(B))).setAttribute("transform","translate(0,"+-(s+0.75)*D*0.4+")")}B=t=="none"?
0.4:2;z.setAttribute("transform","translate(0,"+D*(/^top-/.test(r)?B+(s+0.5)*0.4:-B)+")");z.appendChild(p(+1)).setAttribute("transform","translate(0,"+-(s+0.5)*D*0.4+")");z.appendChild(p(-1)).setAttribute("transform","scale(-1)")}else z=null;v()}var C={},w=q.svg("g"),J={},D=30,A=16,G=0,e=250,o=50,r="top-left",y="small",z,t="small",M,I,P,L,O=q.svg("rect"),E,S,F;w.setAttribute("class","compass");O.setAttribute("class","back fore");O.setAttribute("pointer-events","none");O.setAttribute("display","none");
C.radius=function(s){if(!arguments.length)return D;D=s;E&&x();return C};C.speed=function(s){if(!arguments.length)return D;A=s;return C};C.position=function(s){if(!arguments.length)return r;r=s;E&&x();return C};C.pan=function(s){if(!arguments.length)return t;t=s;E&&x();return C};C.zoom=function(s){if(!arguments.length)return y;y=s;E&&x();return C};C.map=function(s){if(!arguments.length)return E;if(E){S.removeEventListener("mousedown",a,false);S.removeChild(w);S=null;F.removeEventListener("mousemove",
l,false);F.removeEventListener("mouseup",h,false);F=null;E.off("move",v).off("resize",v)}if(E=s){S=E.container();S.appendChild(w);S.addEventListener("mousedown",a,false);F=S.ownerDocument.defaultView;F.addEventListener("mousemove",l,false);F.addEventListener("mouseup",h,false);E.on("move",v).on("resize",v);x()}return C};return C};q.grid=function(){function g(){var h=l.firstChild,d=a.size(),c=a.pointLocation(Z);a.pointLocation(d);var j=Math.pow(2,4-Math.round(a.zoom()));c.lat=Math.floor(c.lat/j)*j;
c.lon=Math.ceil(c.lon/j)*j;for(var n;(n=a.locationPoint(c).x)<=d.x;c.lon+=j){h||(h=l.appendChild(q.svg("line")));h.setAttribute("x1",n);h.setAttribute("x2",n);h.setAttribute("y1",0);h.setAttribute("y2",d.y);h=h.nextSibling}for(;(n=a.locationPoint(c).y)<=d.y;c.lat-=j){h||(h=l.appendChild(q.svg("line")));h.setAttribute("y1",n);h.setAttribute("y2",n);h.setAttribute("x1",0);h.setAttribute("x2",d.x);h=h.nextSibling}for(;h;){d=h.nextSibling;l.removeChild(h);h=d}}var i={},a,l=q.svg("g");l.setAttribute("class",
"grid");i.map=function(h){if(!arguments.length)return a;if(a){l.parentNode.removeChild(l);a.off("move",g).off("resize",g)}if(a=h){a.on("move",g).on("resize",g);a.container().appendChild(l);a.dispatch({type:"move"})}return i};return i};q.stylist=function(){function g(h){var d=h.features.length,c=i.length,j=a.length,n,m,k,f,p,u;for(p=0;p<d;++p)if(m=(n=h.features[p]).element){n=n.data;for(u=0;u<c;++u){f=(k=i[u]).value;if(typeof f==="function")f=f.call(null,n);f==null?k.name.local?m.removeAttributeNS(k.name.space,
k.name.local):m.removeAttribute(k.name):k.name.local?m.setAttributeNS(k.name.space,k.name.local,f):m.setAttribute(k.name,f)}for(u=0;u<j;++u){f=(k=a[u]).value;if(typeof f==="function")f=f.call(null,n);f==null?m.style.removeProperty(k.name):m.style.setProperty(k.name,f,k.priority)}if(f=l){if(typeof f==="function")f=f.call(null,n);for(;m.lastChild;)m.removeChild(m.lastChild);f!=null&&m.appendChild(q.svg("title")).appendChild(document.createTextNode(f))}}}var i=[],a=[],l;g.attr=function(h,d){i.push({name:ha(h),
value:d});return g};g.style=function(h,d,c){a.push({name:h,value:d,priority:arguments.length<3?null:c});return g};g.title=function(h){l=h;return g};return g}})(mapsense);
